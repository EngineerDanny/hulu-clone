import Head from "next/head";
import Header from "../components/Header";
import MovieTile from "../components/MovieTile";
import Nav from "../components/Nav";

import { CATEGORIES } from "../utils/constants";

export default function Home({ movies }) {
  return (
    <div className="flex justify-center p-5 flex-col items-center">
      <Head>
        <title>Hulu Clone</title>
        <meta name="description" content="Generated by create next app" />
        <link rel="icon" href="/favicon.ico" />
      </Head>
      <Header />
      <Nav />
      <main>
        {movies.map((movie) => {
          return <MovieTile movie={movie} key={movie.id} />;
        })}
      </main>
    </div>
  );
}

export const getServerSideProps = async (context) => {
  let genre = context.query.genre || "trending";
  //Get the url matching the genre passed from the list
  const category = CATEGORIES.find((c) => c.genre === genre);
  //Get the url from the category
  const url = category.url;

  console.log(url);
  
  //Get the data from the url
  const res = await fetch(url);

  const { results } = await res.json();
  console.log(results[0].id);
  return {
    props: {
      genre: genre,
      movies: results,
    },
  };
};
